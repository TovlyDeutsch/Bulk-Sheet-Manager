<link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<style>
.branding-below {
  bottom: 56px;
  top: 0;
}
#FormPreview {
border: 2px solid #cccccc;
padding: 10px;
padding-right: 100px; 

}
.sectionHeader {
border-bottom: 2px solid #cccccc;
padding-bottom: 2px;
font-weight:bold;

}
.sectionFooter {
border-top: 2px solid #cccccc;
padding-top: 2px;

}

.empty {
-webkit-box-shadow: inset 0px 0px 5px 2px #dd4b39;
-moz-box-shadow: inset 0px 0px 5px 2px #dd4b39;
box-shadow: inset 0px 0px 5px 2px #dd4b39;
border: 1px solid #dd4b39;

}
.errorText {
color: #dd4b39;
}

.pageOneTextInputs {
display: block;
}

.refreshButton {
width: 25px;
  min-width: 0;
  height: 25px;
  line-height: 0;
  padding: 0;
  display: inline;
  margin: 0 20px;
  margin-right: 30px;
  float: right;
  margin-top: 10px;
}

.sheetsTitle {
  display: inline-block;
  width: 190px;
  margin-bottom: 0;
}

.sheetCheckWrapper {
padding: 5px;
cursor: default;
}

.SelectAllCheckWrapper {
padding: 5px;
cursor: default;
font-weight: bold;
}

.selected {
background-color: #4285f4;
color: #fff;
}

.checkList {
  margin-top: 0 !important;
}

#placeHolderButton {
visibility: hidden;
}

</style>

<div class="sidebar branding-below">
  <div class="block">
  <h1 class="sectionHeader sheetsTitle">Sheets</h1><button onclick="refresh()" class="refreshButton">
  <svg enable-background="new 0 0 32 32" height="16px" id="Layer_1" version="1.1" viewBox="0 0 32 32" width="16px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M25.032,26.16c2.884-2.883,4.184-6.74,3.928-10.51c-1.511,0.013-3.021,0.021-4.531,0.034  c0.254,2.599-0.603,5.287-2.594,7.277c-3.535,3.533-9.263,3.533-12.796,0c-3.534-3.533-3.534-9.26,0-12.794  c3.015-3.016,7.625-3.446,11.109-1.314c-1.181,1.167-2.57,2.549-2.57,2.549c-1,1.062,0.016,1.766,0.69,1.77h8.828  c0.338,0,0.611-0.274,0.612-0.612V3.804c0.041-0.825-0.865-1.591-1.756-0.7c0,0-1.495,1.48-2.533,2.509  C18.112,1.736,10.634,2.175,5.841,6.967c-5.3,5.3-5.3,13.892,0,19.193C11.141,31.459,19.733,31.459,25.032,26.16z" fill="#515151" id="Refresh"/></svg>
  </button>
  <div id="selectAll" class="SelectAllCheckWrapper" onclick="groupSelector()"><input onclick="groupSelector()" class="SelectAllCheckbox" id="selectAllHeader" type="checkbox" name="SelectAll">Select All</div>
  </div>
<div class="block checkList">

</div>

 <div id= "lastButtonBlock" class="block">
    <button class="create deleteButton actionButton" id="Deleting">DELETE</button>
    <button class ="actionButton" id="Protecting">Protect</button>
    <button class ="actionButton" id="Hiding">Hide</button>
    <div style="margin-top: 12px;">
    <button id="placeHolderButton"></button>
    <button class ="actionButton" id="Unprotecting">Unprotect</button>
    <button class ="actionButton" id="Unhiding">Unhide</button>
    </div>
  </div>
  
</div>

<div class="sidebar bottom">
<img alt="Add-on logo" class="logo" width="27" height="27" src="http://i.imgur.com/4eabfxm.png">
  <span class="gray">
   Bulk Sheet Manager by Tovly Deutsch</span>
</div>
<script>
var selectType = true;
var shift = false;
var thisNum;
var lastNum;
var lowerNum;
var higherNum;
$( document ).keydown(function() {
  if (event.which == 16) {
  shift = true;
  }
  
});

$( document ).keyup(function() {
  if (event.which == 16) {
  shift = false;
  }
  
});

function groupSelector() {

  $( ".sheetCheckbox" ).each(function(){
    $(this).prop('checked', selectType);
  });
  $( ".sheetCheckbox" ).parent().addClass('selected');
  $(".sheetCheckbox:not(:checked)").parent().removeClass('selected');
  selectType = !selectType;
  if (selectType == false) {
    document.getElementById('selectAllHeader').innerHTML = 'Deselect All';
  }
  else {
    document.getElementById('selectAllHeader').innerHTML = 'Select All';
  }
}

function addLoader(action, additionalParams) {

//$('#lastButtonBlock').after('<span class="loader"><span class="loader-inner"><span class="innerText"' + '>' + action + '</span></span></span>');
$('#lastButtonBlock').after('<span class="loader"><span class="loader-inner"></span></span>');
}
 function onGetSheetsFailure(error) {
 $('.loader').remove();
 google.script.run.withSuccessHandler(google.script.host.close).gsSheetGetFail();
 }
 $( ".SelectAllCheckWrapper" ).click(function() {
 $('#selectError').remove();
  var checkBox = $(this).find(">:first-child");
  checkBox.prop('checked', !checkBox.prop('checked'));
    $( ".sheetCheckbox:checked" ).parent().addClass('selected');
    $(".sheetCheckbox:not(:checked)").parent().removeClass('selected');
 });
 
   $( ".SelectAllCheckbox" ).click(function( event ) {
    event.stopPropagation();
    $('#selectError').remove();
    $( ".sheetCheckbox:checked" ).parent().addClass('selected');
    $(".sheetCheckbox:not(:checked)").parent().removeClass('selected');   
  });

 
function onGetSheetsSuccess(sheets) {
  $('.loader').remove();
  $( ".sheetCheckWrapper" ).remove();
  for (var i = 0; i < sheets.length; i++) {

    $('.checkList').append('<div id="' + i + '" class="sheetCheckWrapper"><input class="sheetCheckbox" type="checkbox" name="' + sheets[i].name + '">' + sheets[i].name + '</div>');
    
  }
  $( ".sheetCheckbox" ).click(function( event ) {
    event.stopPropagation();
    $('#selectError').remove();
    if (shift == true) {
      thisNum = +$(this).parent().prop('id');
      lastNum = +$('.lastClicked').prop('id');
      lowerNum = Math.min(thisNum, lastNum) + 1;
      higherNum = Math.max(thisNum, lastNum);
        for (var i = lowerNum; i < higherNum; i++) {
          var checkBox = $('#' + i.toString()).find(">:first-child");
          checkBox.prop('checked', !checkBox.prop('checked'));
        }    
    }
    $( ".sheetCheckbox:checked" ).parent().addClass('selected');
    $(".sheetCheckbox:not(:checked)").parent().removeClass('selected');
    $(".lastClicked").removeClass('lastClicked');
    $(this).parent().addClass('lastClicked');
    
  });
  $( ".sheetCheckWrapper" ).click(function() {
  $('#selectError').remove();
  if (shift == true) {
      thisNum = +$(this).prop('id');
      lastNum = +$('.lastClicked').prop('id');
      lowerNum = Math.min(thisNum, lastNum) + 1;
      higherNum = Math.max(thisNum, lastNum);
        for (var i = lowerNum; i < higherNum; i++) {
          var checkBox = $('#' + i.toString()).find(">:first-child");
          checkBox.prop('checked', !checkBox.prop('checked'));
        }    
    }
  var checkBox = $(this).find(">:first-child");
  checkBox.prop('checked', !checkBox.prop('checked'));
    $( ".sheetCheckbox:checked" ).parent().addClass('selected');
    $(".sheetCheckbox:not(:checked)").parent().removeClass('selected');
    $(".lastClicked").removeClass('lastClicked');
    $(this).addClass('lastClicked');
    
  });
  
}

google.script.run.withSuccessHandler(onGetSheetsSuccess).withFailureHandler(onGetSheetsFailure).getSheets();

function onActionSuccess(action) {
    $('.loader').remove();
    if (action.completed == false) {
      $('#lastButtonBlock').after('<p class="errorText" id="firstError">Not all the sheets you selected could be' + action.word + '</p>');
    }
    google.script.run.withSuccessHandler(onGetSheetsSuccess).withFailureHandler(onGetSheetsFailure).getSheets();
}

function onActionFailure(error) {
  $('.loader').remove();
  var errorMessage = error.message;
  if (errorMessage.indexOf('null') > -1) {
    errorMessage = 'Not all the sheets you selected could be acted on';
  }
  if (errorMessage.indexOf('undefined') == -1) {
    $('#lastButtonBlock').after('<p class="errorText" id="firstError">' + errorMessage + '</p>');
  }
  google.script.run.withSuccessHandler(onGetSheetsSuccess).withFailureHandler(onGetSheetsFailure).getSheets();
}

$( ".actionButton" ).click(function() {
$('.errorText').remove();
var selected = [];
$('.checkList input:checked').each(function() {
    selected.push($(this).attr('name'));
});
if (selected.length == 0) {
  $('#lastButtonBlock').after('<p class="errorText" id="selectError">Please select a sheet</p>');
  return;
}

addLoader(this.id + '<br>Sheets');
google.script.run.withSuccessHandler(onActionSuccess).withFailureHandler(onActionFailure).gsActOnSelected(selected, this.id);
});

function refresh() {
//$('#lastButtonBlock').after('<span class="loader blue"><span class="loader-inner blueInner"><span class="innerText">Refreshing</span></span></span>');
addLoader();
google.script.run.withSuccessHandler(onGetSheetsSuccess).withFailureHandler(onGetSheetsFailure).getSheets();
}

//$( ".target" ).change(function() {

</script>
<style>
.loader {
  display: inline-block;
  width: 60px;
  height: 60px;
  position: relative;
  border: 4px solid #d14836;
  top: 50%;
  animation: loader 2s infinite ease;
    margin: 30px auto;
  left: 90px;
}
.blue {
 border: 4px solid #4889f1 !important;
}
.blueInner {
background-color: #4889f1 !important;
}

.loader-inner {
  vertical-align: top;
  display: inline-block;
  width: 100%;
  background-color: #d14836;
  animation: loader-inner 2s infinite ease-in;
  text-align: center;
}

@keyframes loader {
  0% {
    transform: rotate(0deg);
  }
  
  25% {
    transform: rotate(180deg);
  }
  
  50% {
    transform: rotate(180deg);
  }
  
  75% {
    transform: rotate(360deg);
  }
  
  100% {
    transform: rotate(360deg);
  }
}

@keyframes loader-inner {
  0% {
    height: 0%;
  }
  
  25% {
    height: 0%;
  }
  
  50% {
    height: 100%;
  }
  
  75% {
    height: 100%;
  }
  
  100% {
    height: 0%;
  }
}
.innerText {
  
  animation: innerText 2s infinite ease;
    font-weight: 700;
    text-align: center;
}

@keyframes innerText {
  0% {
    transform: rotate(0deg);
  }
  
  25% {
    transform: rotate(180deg);
  }
  
  50% {
    transform: rotate(180deg);
  }
  
  75% {
    transform: rotate(360deg);
  }
  
  100% {
    transform: rotate(360deg);
  }
}
</style>